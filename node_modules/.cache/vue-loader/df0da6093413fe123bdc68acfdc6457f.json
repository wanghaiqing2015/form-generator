{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\form-generator\\src\\views\\index\\JsonDrawer.vue?vue&type=style&index=0&id=6ccba290&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\src\\views\\index\\JsonDrawer.vue","mtime":1619538169718},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgJ0Avc3R5bGVzL21peGluLnNjc3MnOwoKOjp2LWRlZXAgLmVsLWRyYXdlcl9faGVhZGVyIHsKICBkaXNwbGF5OiBub25lOwp9CkBpbmNsdWRlIGFjdGlvbi1iYXI7CgouanNvbi1lZGl0b3J7CiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMzNweCk7Cn0K"},{"version":3,"sources":["JsonDrawer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqIA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"JsonDrawer.vue","sourceRoot":"src/views/index","sourcesContent":["<template>\n  <div>\n    <el-drawer v-bind=\"$attrs\" v-on=\"$listeners\" @opened=\"onOpen\" @close=\"onClose\">\n      <div class=\"action-bar\" :style=\"{'text-align': 'left'}\">\n        <span class=\"bar-btn\" @click=\"refresh\">\n          <i class=\"el-icon-refresh\" />\n          刷新\n        </span>\n        <span ref=\"copyBtn\" class=\"bar-btn copy-json-btn\">\n          <i class=\"el-icon-document-copy\" />\n          复制JSON\n        </span>\n        <span class=\"bar-btn\" @click=\"exportJsonFile\">\n          <i class=\"el-icon-download\" />\n          导出JSON文件\n        </span>\n        <span class=\"bar-btn delete-btn\" @click=\"$emit('update:visible', false)\">\n          <i class=\"el-icon-circle-close\" />\n          关闭\n        </span>\n      </div>\n      <div id=\"editorJson\" class=\"json-editor\" />\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport { beautifierConf } from '@/utils/index'\nimport ClipboardJS from 'clipboard'\nimport { saveAs } from 'file-saver'\nimport loadMonaco from '@/utils/loadMonaco'\nimport loadBeautifier from '@/utils/loadBeautifier'\n\nlet beautifier\nlet monaco\n\nexport default {\n  components: {},\n  props: {\n    jsonStr: {\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {}\n  },\n  computed: {},\n  watch: {},\n  created() {},\n  mounted() {\n    window.addEventListener('keydown', this.preventDefaultSave)\n    const clipboard = new ClipboardJS('.copy-json-btn', {\n      text: trigger => {\n        this.$notify({\n          title: '成功',\n          message: '代码已复制到剪切板，可粘贴。',\n          type: 'success'\n        })\n        return this.beautifierJson\n      }\n    })\n    clipboard.on('error', e => {\n      this.$message.error('代码复制失败')\n    })\n  },\n  beforeDestroy() {\n    window.removeEventListener('keydown', this.preventDefaultSave)\n  },\n  methods: {\n    preventDefaultSave(e) {\n      if (e.key === 's' && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault()\n      }\n    },\n    onOpen() {\n      loadBeautifier(btf => {\n        beautifier = btf\n        this.beautifierJson = beautifier.js(this.jsonStr, beautifierConf.js)\n\n        loadMonaco(val => {\n          monaco = val\n          this.setEditorValue('editorJson', this.beautifierJson)\n        })\n      })\n    },\n    onClose() {},\n    setEditorValue(id, codeStr) {\n      if (this.jsonEditor) {\n        this.jsonEditor.setValue(codeStr)\n      } else {\n        this.jsonEditor = monaco.editor.create(document.getElementById(id), {\n          value: codeStr,\n          theme: 'vs-dark',\n          language: 'json',\n          automaticLayout: true\n        })\n        // ctrl + s 刷新\n        this.jsonEditor.onKeyDown(e => {\n          if (e.keyCode === 49 && (e.metaKey || e.ctrlKey)) {\n            this.refresh()\n          }\n        })\n      }\n    },\n    exportJsonFile() {\n      this.$prompt('文件名:', '导出文件', {\n        inputValue: `${+new Date()}.json`,\n        closeOnClickModal: false,\n        inputPlaceholder: '请输入文件名'\n      }).then(({ value }) => {\n        if (!value) value = `${+new Date()}.json`\n        const codeStr = this.jsonEditor.getValue()\n        const blob = new Blob([codeStr], { type: 'text/plain;charset=utf-8' })\n        saveAs(blob, value)\n      })\n    },\n    refresh() {\n      try {\n        this.$emit('refresh', JSON.parse(this.jsonEditor.getValue()))\n      } catch (error) {\n        this.$notify({\n          title: '错误',\n          message: 'JSON格式错误，请检查',\n          type: 'error'\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/styles/mixin.scss';\n\n::v-deep .el-drawer__header {\n  display: none;\n}\n@include action-bar;\n\n.json-editor{\n  height: calc(100vh - 33px);\n}\n</style>\n"]}]}