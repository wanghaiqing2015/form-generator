{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\form-generator\\src\\views\\index\\FormDrawer.vue?vue&type=style&index=0&id=a50ec128&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\src\\views\\index\\FormDrawer.vue","mtime":1619538169718},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\form-generator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICdAL3N0eWxlcy9taXhpbi5zY3NzJzsKLnRhYi1lZGl0b3IgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDMzcHg7CiAgYm90dG9tOiAwOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgZm9udC1zaXplOiAxNHB4Owp9Ci5sZWZ0LWVkaXRvciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGhlaWdodDogMTAwJTsKICBiYWNrZ3JvdW5kOiAjMWUxZTFlOwogIG92ZXJmbG93OiBoaWRkZW47Cn0KLnNldHRpbmd7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHJpZ2h0OiAxNXB4OwogIHRvcDogM3B4OwogIGNvbG9yOiAjYTlmMTIyOwogIGZvbnQtc2l6ZTogMThweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgei1pbmRleDogMTsKfQoucmlnaHQtcHJldmlldyB7CiAgaGVpZ2h0OiAxMDAlOwogIC5yZXN1bHQtd3JhcHBlciB7CiAgICBoZWlnaHQ6IGNhbGMoMTAwdmggLSAzM3B4KTsKICAgIHdpZHRoOiAxMDAlOwogICAgb3ZlcmZsb3c6IGF1dG87CiAgICBwYWRkaW5nOiAxMnB4OwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICB9Cn0KQGluY2x1ZGUgYWN0aW9uLWJhcjsKOjp2LWRlZXAgLmVsLWRyYXdlcl9faGVhZGVyIHsKICBkaXNwbGF5OiBub25lOwp9Cg=="},{"version":3,"sources":["FormDrawer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FormDrawer.vue","sourceRoot":"src/views/index","sourcesContent":["<template>\n  <div>\n    <el-drawer v-bind=\"$attrs\" v-on=\"$listeners\" @opened=\"onOpen\" @close=\"onClose\">\n      <div style=\"height:100%\">\n        <el-row style=\"height:100%;overflow:auto\">\n          <el-col :md=\"24\" :lg=\"12\" class=\"left-editor\">\n            <div class=\"setting\" title=\"资源引用\" @click=\"showResource\">\n              <el-badge :is-dot=\"!!resources.length\" class=\"item\">\n                <i class=\"el-icon-setting\" />\n              </el-badge>\n            </div>\n            <el-tabs v-model=\"activeTab\" type=\"card\" class=\"editor-tabs\">\n              <el-tab-pane name=\"html\">\n                <span slot=\"label\">\n                  <i v-if=\"activeTab==='html'\" class=\"el-icon-edit\" />\n                  <i v-else class=\"el-icon-document\" />\n                  template\n                </span>\n              </el-tab-pane>\n              <el-tab-pane name=\"js\">\n                <span slot=\"label\">\n                  <i v-if=\"activeTab==='js'\" class=\"el-icon-edit\" />\n                  <i v-else class=\"el-icon-document\" />\n                  script\n                </span>\n              </el-tab-pane>\n              <el-tab-pane name=\"css\">\n                <span slot=\"label\">\n                  <i v-if=\"activeTab==='css'\" class=\"el-icon-edit\" />\n                  <i v-else class=\"el-icon-document\" />\n                  css\n                </span>\n              </el-tab-pane>\n            </el-tabs>\n            <div v-show=\"activeTab==='html'\" id=\"editorHtml\" class=\"tab-editor\" />\n            <div v-show=\"activeTab==='js'\" id=\"editorJs\" class=\"tab-editor\" />\n            <div v-show=\"activeTab==='css'\" id=\"editorCss\" class=\"tab-editor\" />\n          </el-col>\n          <el-col :md=\"24\" :lg=\"12\" class=\"right-preview\">\n            <div class=\"action-bar\" :style=\"{'text-align': 'left'}\">\n              <span class=\"bar-btn\" @click=\"runCode\">\n                <i class=\"el-icon-refresh\" />\n                刷新\n              </span>\n              <span class=\"bar-btn\" @click=\"exportFile\">\n                <i class=\"el-icon-download\" />\n                导出vue文件\n              </span>\n              <span ref=\"copyBtn\" class=\"bar-btn copy-btn\">\n                <i class=\"el-icon-document-copy\" />\n                复制代码\n              </span>\n              <span class=\"bar-btn delete-btn\" @click=\"$emit('update:visible', false)\">\n                <i class=\"el-icon-circle-close\" />\n                关闭\n              </span>\n            </div>\n            <iframe\n              v-show=\"isIframeLoaded\"\n              ref=\"previewPage\"\n              class=\"result-wrapper\"\n              frameborder=\"0\"\n              src=\"preview.html\"\n              @load=\"iframeLoad\"\n            />\n            <div v-show=\"!isIframeLoaded\" v-loading=\"true\" class=\"result-wrapper\" />\n          </el-col>\n        </el-row>\n      </div>\n    </el-drawer>\n    <resource-dialog\n      :visible.sync=\"resourceVisible\"\n      :origin-resource=\"resources\"\n      @save=\"setResource\"\n    />\n  </div>\n</template>\n<script>\nimport { parse } from '@babel/parser'\nimport ClipboardJS from 'clipboard'\nimport { saveAs } from 'file-saver'\nimport {\n  makeUpHtml, vueTemplate, vueScript, cssStyle\n} from '@/components/generator/html'\nimport { makeUpJs } from '@/components/generator/js'\nimport { makeUpCss } from '@/components/generator/css'\nimport { exportDefault, beautifierConf, titleCase } from '@/utils/index'\nimport ResourceDialog from './ResourceDialog'\nimport loadMonaco from '@/utils/loadMonaco'\nimport loadBeautifier from '@/utils/loadBeautifier'\n\nconst editorObj = {\n  html: null,\n  js: null,\n  css: null\n}\nconst mode = {\n  html: 'html',\n  js: 'javascript',\n  css: 'css'\n}\nlet beautifier\nlet monaco\n\nexport default {\n  components: { ResourceDialog },\n  props: ['formData', 'generateConf'],\n  data() {\n    return {\n      activeTab: 'html',\n      htmlCode: '',\n      jsCode: '',\n      cssCode: '',\n      codeFrame: '',\n      isIframeLoaded: false,\n      isInitcode: false, // 保证open后两个异步只执行一次runcode\n      isRefreshCode: false, // 每次打开都需要重新刷新代码\n      resourceVisible: false,\n      scripts: [],\n      links: [],\n      monaco: null\n    }\n  },\n  computed: {\n    resources() {\n      return this.scripts.concat(this.links)\n    }\n  },\n  watch: {},\n  created() {\n  },\n  mounted() {\n    window.addEventListener('keydown', this.preventDefaultSave)\n    const clipboard = new ClipboardJS('.copy-btn', {\n      text: trigger => {\n        const codeStr = this.generateCode()\n        this.$notify({\n          title: '成功',\n          message: '代码已复制到剪切板，可粘贴。',\n          type: 'success'\n        })\n        return codeStr\n      }\n    })\n    clipboard.on('error', e => {\n      this.$message.error('代码复制失败')\n    })\n  },\n  beforeDestroy() {\n    window.removeEventListener('keydown', this.preventDefaultSave)\n  },\n  methods: {\n    preventDefaultSave(e) {\n      if (e.key === 's' && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault()\n      }\n    },\n    onOpen() {\n      const { type } = this.generateConf\n      this.htmlCode = makeUpHtml(this.formData, type)\n      this.jsCode = makeUpJs(this.formData, type)\n      this.cssCode = makeUpCss(this.formData)\n\n      loadBeautifier(btf => {\n        beautifier = btf\n        this.htmlCode = beautifier.html(this.htmlCode, beautifierConf.html)\n        this.jsCode = beautifier.js(this.jsCode, beautifierConf.js)\n        this.cssCode = beautifier.css(this.cssCode, beautifierConf.html)\n\n        loadMonaco(val => {\n          monaco = val\n          this.setEditorValue('editorHtml', 'html', this.htmlCode)\n          this.setEditorValue('editorJs', 'js', this.jsCode)\n          this.setEditorValue('editorCss', 'css', this.cssCode)\n          if (!this.isInitcode) {\n            this.isRefreshCode = true\n            this.isIframeLoaded && (this.isInitcode = true) && this.runCode()\n          }\n        })\n      })\n    },\n    onClose() {\n      this.isInitcode = false\n      this.isRefreshCode = false\n    },\n    iframeLoad() {\n      if (!this.isInitcode) {\n        this.isIframeLoaded = true\n        this.isRefreshCode && (this.isInitcode = true) && this.runCode()\n      }\n    },\n    setEditorValue(id, type, codeStr) {\n      if (editorObj[type]) {\n        editorObj[type].setValue(codeStr)\n      } else {\n        editorObj[type] = monaco.editor.create(document.getElementById(id), {\n          value: codeStr,\n          theme: 'vs-dark',\n          language: mode[type],\n          automaticLayout: true\n        })\n      }\n      // ctrl + s 刷新\n      editorObj[type].onKeyDown(e => {\n        if (e.keyCode === 49 && (e.metaKey || e.ctrlKey)) {\n          this.runCode()\n        }\n      })\n    },\n    runCode() {\n      const jsCodeStr = editorObj.js.getValue()\n      try {\n        const ast = parse(jsCodeStr, { sourceType: 'module' })\n        const astBody = ast.program.body\n        if (astBody.length > 1) {\n          this.$confirm(\n            'js格式不能识别，仅支持修改export default的对象内容',\n            '提示',\n            {\n              type: 'warning'\n            }\n          )\n          return\n        }\n        if (astBody[0].type === 'ExportDefaultDeclaration') {\n          const postData = {\n            type: 'refreshFrame',\n            data: {\n              generateConf: this.generateConf,\n              html: editorObj.html.getValue(),\n              js: jsCodeStr.replace(exportDefault, ''),\n              css: editorObj.css.getValue(),\n              scripts: this.scripts,\n              links: this.links\n            }\n          }\n\n          this.$refs.previewPage.contentWindow.postMessage(\n            postData,\n            location.origin\n          )\n        } else {\n          this.$message.error('请使用export default')\n        }\n      } catch (err) {\n        this.$message.error(`js错误：${err}`)\n        console.error(err)\n      }\n    },\n    generateCode() {\n      const html = vueTemplate(editorObj.html.getValue())\n      const script = vueScript(editorObj.js.getValue())\n      const css = cssStyle(editorObj.css.getValue())\n      return beautifier.html(html + script + css, beautifierConf.html)\n    },\n    exportFile() {\n      this.$prompt('文件名:', '导出文件', {\n        inputValue: `${+new Date()}.vue`,\n        closeOnClickModal: false,\n        inputPlaceholder: '请输入文件名'\n      }).then(({ value }) => {\n        if (!value) value = `${+new Date()}.vue`\n        const codeStr = this.generateCode()\n        const blob = new Blob([codeStr], { type: 'text/plain;charset=utf-8' })\n        saveAs(blob, value)\n      })\n    },\n    showResource() {\n      this.resourceVisible = true\n    },\n    setResource(arr) {\n      const scripts = []; const\n        links = []\n      if (Array.isArray(arr)) {\n        arr.forEach(item => {\n          if (item.endsWith('.css')) {\n            links.push(item)\n          } else {\n            scripts.push(item)\n          }\n        })\n        this.scripts = scripts\n        this.links = links\n      } else {\n        this.scripts = []\n        this.links = []\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/styles/mixin.scss';\n.tab-editor {\n  position: absolute;\n  top: 33px;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  font-size: 14px;\n}\n.left-editor {\n  position: relative;\n  height: 100%;\n  background: #1e1e1e;\n  overflow: hidden;\n}\n.setting{\n  position: absolute;\n  right: 15px;\n  top: 3px;\n  color: #a9f122;\n  font-size: 18px;\n  cursor: pointer;\n  z-index: 1;\n}\n.right-preview {\n  height: 100%;\n  .result-wrapper {\n    height: calc(100vh - 33px);\n    width: 100%;\n    overflow: auto;\n    padding: 12px;\n    box-sizing: border-box;\n  }\n}\n@include action-bar;\n::v-deep .el-drawer__header {\n  display: none;\n}\n</style>\n"]}]}